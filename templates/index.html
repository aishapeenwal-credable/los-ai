<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LOS AI Chat Assistant</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    :root {
      --primary: #000000;
      --secondary: #f3f4f6;
      --bg: #ffffff;
      --text: #1f1f1f;
      --highlight: #d98e04;
      --card-bg: #f8f9fa;
      --radius: 16px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    header {
      width: 100%;
      background-color: var(--primary);
      padding: 10px 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    header img {
      height: 50px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1, h3 {
      color: var(--primary);
    }

    .button {
      padding: 14px 28px;
      margin: 10px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: var(--radius);
      cursor: pointer;
      transition: background 0.3s;
    }

    .primary {
      background: var(--primary);
      color: white;
    }
    .primary:hover {
      background: #333;
    }

    .secondary {
      background: var(--secondary);
      color: var(--text);
      border: 1px solid #d1d5db;
    }
    .secondary:hover {
      background: #e5e7eb;
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      padding: 24px;
      margin: 16px 0;
      width: 100%;
      max-width: 700px;
      transition: transform 0.2s;
    }
    .card:hover {
      transform: translateY(-4px);
    }

    .flex-container {
      display: flex;
      flex-wrap: wrap;
      gap: 32px;
      margin-top: 32px;
      width: 100%;
    }

    .summary, .chatbox {
      flex: 1 1 45%;
      background: var(--card-bg);
      padding: 24px;
      border-radius: var(--radius);
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    input, textarea {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border-radius: var(--radius);
      border: 1px solid #e5e7eb;
      font-size: 14px;
    }

    #vizContainer {
      margin-top: 20px;
    }

    strong {
      color: var(--highlight);
    }
  </style>
</head>
<body>
  <header>
    <img src="/static/partner-credable-600x600_1.jpg.webp" alt="CredAble Logo">
  </header>

  <div class="container" id="welcomeScreen">
    <h1>Welcome to the LOS AI Chat Assistant</h1>
    <button class="button primary" onclick="showApplications()">View Applications</button>
    <button class="button secondary">Create New Application</button>
  </div>

  <div class="container" id="applicationList" style="display:none;">
    <div class="card">
      <h3>M/S Bluten Marketing Private Limited</h3>
      <p>Status: <strong>Processed</strong></p>
      <button class="button primary" onclick="openChat('Bluten')">View Application</button>
    </div>
    <div class="card">
      <h3>M/S Esquire Electrovision Private Limited</h3>
      <p>Status: <strong>Pending</strong></p>
    </div>
  </div>

  <div class="container" id="chatInterface" style="display:none;">
    <div class="flex-container">
      <div class="summary">
  <h3 id="companyName">Company Summary</h3>
  <p><strong>Overall Application Summary:</strong></p>
  <p><strong>Company Overview:</strong><br>
  Name: Bluten Marketing Private Limited<br>
  Registered office: Wadgaon Sheri, Pune, Maharashtra<br>
  Main activity: Retail Trading (primarily sarees, handlooms, and related textiles)<br>
  Status: Active, Unlisted, Incorporated on October 1, 2018<br>
  Banker: HDFC Bank (with significant overdraft facilities)<br>
  Recent Charges: Hypothecation with HDFC Bank, secured against stocks and receivables, recently increased from ₹3 crore to ₹4.9 crore.</p>

  <p><strong>Directors & Shareholding:</strong><br>
  Pushkar Shukla (holding majority stake): 92% shares (920,000 equity shares)<br>
  Akanksha Kanwal: 8% shares (80,000 equity shares)<br>
  The promoters/directors collectively control the entire equity stake of the company (100%).</p>

  <p><strong>Financial Overview:</strong><br>
  GST Turnover Performance (selected recent months, explicitly provided data):<br>
  - Moderate volatility, large fluctuations in monthly sales turnover.<br>
  - Notable increases year-on-year in July-August 2024; marked declines in September, November, and December 2024.</p>

  <p><strong>Bank Statement Observations:</strong><br>
  - Frequent and prolonged periods of negative balances (large overdrafts exceeding ₹4 crores regularly).<br>
  - Heavy reliance on external borrowings (loans noted from Indifi Capital, Ugro Capital).<br>
  - Modest cash reserves; frequent overdraft utilization hinting at weak liquidity management.<br>
  - Frequent inflows from online payment gateways (Razorpay), and logistic services (Blue Dart), reflecting a fragmented cash inflow system.</p>

  <p><strong>Financial Statement Highlights (Explicitly Provided):</strong><br>
  - Total Current Assets (latest available): ₹135.89 million<br>
  - Total Debt: ₹50.64 million<br>
  - Net Fixed Assets: Approx. ₹2.02 million<br>
  - Trade Receivables: ₹48.62 million, Inventories: ₹4.01 million, Cash and Bank: ₹1.66 million<br>
  - Equity Capital: Recent equity allotment at ₹9.9 million (990,000 shares at ₹10 each), paid-up capital now at ₹10 million.<br>
  - Auditor’s observations on compliance issues: Noted non-compliance with E-invoicing, GST and E-way bill requirements. Directors have mentioned taking corrective actions.</p>

  <p><strong>Key Financial Red Flags:</strong><br>
  - Persistent overdraft dependency driving poor liquidity metrics.<br>
  - High leverage ratio, with recent increase in secured borrowings.<br>
  - Volatile and unpredictable sales trends with large fluctuations.<br>
  - Dependence on fragmented online collections.<br>
  - Auditor flagged issues regarding GST compliance and invoicing processes.</p>

  <p><strong>Conclusion:</strong><br>
  Bluten Marketing Pvt Ltd, although operating actively in the retail textile segment with a stable promoter-director structure, presents significant financial risks marked by unstable incomes, liquidity constraints, high leverage, and continued operational dependency on overdrafts and external borrowings. Such issues, alongside noted auditor compliance remarks, present considerable underwriting risk factors for lending decisions.</p>
</div>
      <div class="chatbox">
        <h3>Ask a Question</h3>
        <input type="text" id="queryInput" placeholder="Enter your question here...">
        <button class="button primary" onclick="sendQuery()">Submit</button>
        <textarea id="chatResponse" rows="10" readonly></textarea>
        <div id="vizContainer"></div>
      </div>
    </div>
  </div>

  <script>
    window.currentCompany = "";

    function showApplications() {
      document.getElementById("welcomeScreen").style.display = "none";
      document.getElementById("applicationList").style.display = "block";
    }

    function openChat(companyName) {
      window.currentCompany = companyName;
      document.getElementById("applicationList").style.display = "none";
      document.getElementById("chatInterface").style.display = "block";
      document.getElementById("companyName").textContent = companyName + " Summary";
    }

    async function sendQuery() {
      const input = document.getElementById("queryInput").value.trim();
      const chatBox = document.getElementById("chatResponse");
      const vizContainer = document.getElementById("vizContainer");

      if (!input) return alert("Enter a question.");

      chatBox.value = "Fetching response...";
      vizContainer.innerHTML = "";

      try {
        const res = await fetch("/query", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ application_id: window.currentCompany, query: input })
        });
        const data = await res.json();
        chatBox.value = data.response || "No response received.";

        const vizRes = await fetch("/visualise", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ response: data.response })
        });
        const vizData = await vizRes.json();

        if (vizData.can_visualize && vizData.plotly_instruction) {
          Plotly.newPlot("vizContainer", vizData.plotly_instruction.data, vizData.plotly_instruction.layout || {});
        } else {
          vizContainer.innerHTML = `<p><em>No visualization available.</em></p>`;
        }
      } catch (err) {
        chatBox.value = `Error: ${err.message}`;
      }
    }
  </script>
</body>
</html>
